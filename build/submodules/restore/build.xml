<project name="restore">

  <target name="restore" depends="restore-custom-modules, restore-features-modules, restore-custom-themes, patches-apply" />

  <target name="restore-custom-modules" depends="restore-custom-dir-init">
    <phingcall target="delete-folder">
      <property name="folder.deletable" value="${project.drupal.custom.dir}" />
    </phingcall>
    <copy todir="${project.drupal.custom.dir}">
      <fileset dir="${env.backup.dir}/modules/custom">
        <include name="**"/>
      </fileset>
    </copy>
    <echo msg="Custom modules were restore." />
  </target>

  <target name="restore-features-modules" depends="restore-features-dir-init">
    <phingcall target="delete-folder">
      <property name="folder.deletable" value="${project.drupal.features.dir}" />
    </phingcall>
    <copy todir="${project.drupal.features.dir}">
      <fileset dir="${env.backup.dir}/modules/features">
        <include name="**"/>
      </fileset>
    </copy>
    <echo msg="Features modules were restore." />
  </target>
  
  <target name="restore-custom-themes" depends="restore-theme-dir-init">
    <phingcall target="delete-folder">
      <property name="folder.deletable" value="${project.drupal.theme.dir}" />
    </phingcall>
    <copy todir="${project.drupal.theme.dir}">
      <fileset dir="${env.backup.dir}/themes">
        <include name="**"/>
      </fileset>
    </copy>
  </target>

  <target name="restore-project-files" depends="restore-files-dir-init">
    <phingcall target="delete-folder">
      <property name="folder.deletable" value="${project.drupal.files.dir}" />
    </phingcall>
    <copy todir="${project.drupal.files.dir}">
      <fileset dir="${env.backup.dir}/files">
        <include name="**"/>
      </fileset>
    </copy>
  </target>

  <target name="restore-custom-dir-init">
    <phingcall target="create-folder">
      <property name="folder.creatable" value="${project.drupal.custom.dir}" />
    </phingcall>
  </target>

  <target name="restore-features-dir-init">
    <phingcall target="create-folder">
      <property name="folder.creatable" value="${project.drupal.features.dir}" />
    </phingcall>
  </target>

  <target name="restore-theme-dir-init">
    <phingcall target="create-folder">
      <property name="folder.creatable" value="${project.drupal.theme.dir}" />
    </phingcall>
  </target>

  <target name="restore-files-dir-init">
    <phingcall target="create-folder">
      <property name="folder.creatable" value="${project.drupal.files.dir}" />
    </phingcall>
  </target>

  <target name="restore-nodes">
    <if>
      <available file="${env.backup.dir}/nodes/nodes" property="files_exists" />
      <then>
        <drush command="migrate-auto-register">
          <option name="root">${project.drupal.dir}</option>
        </drush>
        <phingcall target="migrate-import" >
          <property name="drupal.migrate" value="IssueListNodes" />
        </phingcall>
        <phingcall target="migrate-import" >
          <property name="drupal.migrate" value="MediaNodes" />
        </phingcall>
        <phingcall target="migrate-import" >
          <property name="drupal.migrate" value="BookNodes" />
        </phingcall>
        <phingcall target="migrate-import" >
          <property name="drupal.migrate" value="IssueNodes" />
        </phingcall>
        <phingcall target="migrate-import" >
          <property name="drupal.migrate" value="MediaGroupNodes" />
        </phingcall>
        <phingcall target="migrate-import" >
          <property name="drupal.migrate" value="MediaAlbumNodes" />
        </phingcall>
        <phingcall target="migrate-import" >
          <property name="drupal.migrate" value="MediaImageNodes" />
        </phingcall>
        <echo msg="Restore nodes" />
      </then>
    </if>
  </target>

  <target name="migrate-import">
    <drush command="migrate-import">
      <option name="root">${project.drupal.dir}</option>
      <param>${drupal.migrate}</param>
    </drush>
  </target>

</project>