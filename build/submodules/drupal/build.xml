<project name="drupal">
  
  <target name="cc">
    <drush command="cc" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>all</param>
    </drush>
  </target>
  
  <target name="backup-sql">
    <phingcall target="cc"/>
    <if>
      <not>
        <available file="{env.dir}${env.backup.dir}"/>
      </not>
      <then>
        <mkdir dir="${env.dir}${env.backup.dir}" mode="0777"/>
      </then>
    </if>
    <tstamp/>
    <drush command="sql-dump" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <option name="result-file">${env.dir}${env.backup.dir}/${DSTAMP}-${TSTAMP}.sql</option>
    </drush>
  </target>
  
  <target name="run_tests">
    <drush command="pm-enable" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>simpletest</param>
    </drush>
    <drush command="test-run" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>--all</param>
    </drush>
  </target>
  
  <target name="localize">
    <drush command="dl" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>l10n_update, drush_language</param>
    </drush>    
    <drush command="en" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>l10n_update</param>
    </drush>      
    <drush command="language-add" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>ru</param>
    </drush> 
    <phingcall target="flush_cache"/>
    <drush command="language-enable" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>ru</param> 
    </drush>
    <drush command="language-default" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>ru</param>
    </drush>
    <drush command="l10n-update" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
    </drush>
  </target>
  
  <target name="clean-urls-disable">
    <drush command="vset" assume="yes">
      <option name="root">${env.dir}${project.drupal.dir}</option>
      <param>clean_url 0 --yes</param>
    </drush>  
  </target>
  
</project>